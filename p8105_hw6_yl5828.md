p8105_hw6_yl5828
================
Leah Li
2025-12-03

## Problem 0

## Problem 1

``` r
url <- "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"

homicide_data <- read_csv(url)
```

``` r
homicide_df <- homicide_data %>%
  mutate(city_state = paste(city, state, sep = ", ")) %>%
  mutate(resolved = as.numeric(disposition == "Closed by arrest")) %>%
  filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")) %>%
  filter(victim_race %in% c("White", "Black")) %>%
  mutate(victim_age = as.numeric(victim_age)) %>%
  filter(!is.na(victim_age)) %>%
  mutate(
    victim_sex = factor(victim_sex),
    victim_race = factor(victim_race)
  )
```

``` r
baltimore_df <- homicide_df %>%
  filter(city_state == "Baltimore, MD")

baltimore_glm <- glm(
  resolved ~ victim_age + victim_sex + victim_race,
  data = baltimore_df,
  family = binomial()
)

# Tidy the results
baltimore_results <- baltimore_glm %>%
  tidy() %>%
  mutate(
    OR = exp(estimate),
    CI_lower = exp(estimate - 1.96 * std.error),
    CI_upper = exp(estimate + 1.96 * std.error)
  ) %>%
  filter(term == "victim_sexMale") %>%
  select(term, OR, CI_lower, CI_upper)
```

Baltimore, MD Results:

For Baltimore, the adjusted odds ratio for solving homicides comparing
male victims to female victims is 0.426 with 95% CI: (0.325, 0.558).

``` r
city_results <- homicide_df %>%
  nest(data = -city_state) %>%
  mutate(
    model = map(data, ~glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())),
    tidied = map(model, tidy)) %>%
  unnest(tidied) %>%
  filter(term == "victim_sexMale") %>%
  mutate(
    OR = exp(estimate),
    CI_lower = exp(estimate - 1.96 * std.error),
    CI_upper = exp(estimate + 1.96 * std.error)
  ) %>%
  select(city_state, OR, CI_lower, CI_upper) %>%
  arrange(OR)

city_results
```

    ## # A tibble: 47 × 4
    ##    city_state         OR CI_lower CI_upper
    ##    <chr>           <dbl>    <dbl>    <dbl>
    ##  1 New York, NY    0.262    0.138    0.499
    ##  2 Baton Rouge, LA 0.381    0.209    0.695
    ##  3 Omaha, NE       0.382    0.203    0.721
    ##  4 Cincinnati, OH  0.400    0.236    0.677
    ##  5 Chicago, IL     0.410    0.336    0.501
    ##  6 Long Beach, CA  0.410    0.156    1.08 
    ##  7 San Diego, CA   0.413    0.200    0.855
    ##  8 Baltimore, MD   0.426    0.325    0.558
    ##  9 Pittsburgh, PA  0.431    0.265    0.700
    ## 10 Denver, CO      0.479    0.236    0.971
    ## # ℹ 37 more rows

``` r
plot <- city_results %>%
  mutate(city_state = fct_reorder(city_state, OR)) %>%
  ggplot(aes(x = city_state, y = OR)) +
  geom_point(size = 2) +
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper), width = 0.3) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red", alpha = 0.7) +
  coord_flip() +
  labs(
    title = "Adjusted Odds Ratios for Solving Homicides: Male vs Female Victims",
    subtitle = "Adjusted for victim age and race across 47 U.S. cities",
    x = "City",
    y = "Odds Ratio (95% CI)") +
  theme_minimal()

plot
```

<img src="p8105_hw6_yl5828_files/figure-gfm/Create plot-1.png" width="90%" />
